name: automatically assign reviewers

on:
  schedule:
    - cron: "37 0 * * *" # At 00:37 UTC every day
  workflow_dispatch:

jobs:
  autoassign-reviewers:
    name: assign automatically proposed reviewers
    runs-on: ubuntu-latest
    steps:
      - name: download auto-assignments
        run: |
          curl --output assignments.json --silent https://leanprover-community.github.io/queueboard/automatic_assignments.json

      # The Hoskinson runners may not have jq installed, so do that now.
      - name: 'Setup jq'
        uses: dcarbone/install-jq-action@f0e10f46ff84f4d32178b4b76e1ef180b16f82c3 # v3.1.1

      # Parse the json file: TODO, that step is missing.
      - name: parse assignments file and assign reviewers
        run: |
          echo "TODO: parsing the assignments file is not implemented yet!"
          # placeholder logic: assign PR 18754 to grunweg
          number=18754
          user=grunweg
          printf 'about to assign PR "%s" to "%s"' "${number}" "${user}"
          # This keeps any existing assignee on the PR.
          curl --location \
            --request POST \
            --header "Accept: application/vnd.github+json" \
            --header 'authorization: Bearer ${{ secrets.GITHUB_TOKEN }}' \
            --header "X-GitHub-Api-Version: 2022-11-28" \
            https://api.github.com/repos/leanprover-community/mathlib4/issues/$number/assignees \
            --data '{"assignees":["$user"]}'
